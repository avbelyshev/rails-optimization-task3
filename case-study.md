# Case-study оптимизации

## Актуальная проблема
В нашем проекте возникли следующие проблемы:
* Долгий импорт данных в БД
* Долгий рендеринг страницы расписаний

## Формирование метрики
Для того, чтобы понимать, дают ли мои изменения положительный эффект на быстродействие программы я придумал использовать такую метрику:
* время загрузки данных из файла с 1К трипов.
* Loading data from fixtures/small.json - 8.588481 сек
* Бюджет загрузки файла со 100К трипов - 60 сек

## Гарантия корректности работы оптимизированной программы
Тест корректности загрузки данных `spec/services/json_loader_spec.rb`. Выполнение этого теста в фидбек-лупе позволяет не допустить изменения логики программы при оптимизации.

## Feedback-Loop
Для того, чтобы иметь возможность быстро проверять гипотезы я выстроил эффективный `feedback-loop`, который позволил мне получать обратную связь по эффективности сделанных изменений за *время, которое у вас получилось*

Вот как я построил `feedback_loop`:
- анализ отчетов
- изменения в программе
- замер метрики
- запуск теста

## Вникаем в детали системы, чтобы найти главные точки роста
Для того, чтобы найти "точки роста" для оптимизации я воспользовался:
- rack-mini-profiler
- rails panel
- bullet
- explain запросов

Вот какие проблемы удалось найти и решить

### Итерация №1
- Загрузка данных с помощью activerecord-import gem
    * Loading data from fixtures/small.json - 8.588481 сек -> 1.624000 сек
    * Loading data from fixtures/large.json - 57.876000 сек (в рамках бюджета). MEMORY USAGE: 13 MB

## Защита от регрессии производительности
Для защиты от потери достигнутого прогресса при дальнейших изменениях программы `spec/services/json_loader_spec.rb`
